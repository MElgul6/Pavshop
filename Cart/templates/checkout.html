{% extends 'base.html' %}
{% block content %}

{% load static %}

  <!--======= SUB BANNER =========-->
  <section class="sub-bnr" data-stellar-background-ratio="0.5">
    <div class="position-center-center">
      <div class="container">
        <h4>CHECKOUT</h4>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec faucibus maximus vehicula. 
          Sed feugiat, tellus vel tristique posuere, diam</p>
        <ol class="breadcrumb">
          <li><a href="#">Home</a></li>
          <li><a href="#">SHOP</a></li>
          <li class="active">CHECKOUT</li>
        </ol>
      </div>
    </div>
  </section>
  
  <!-- Content -->
  <div id="content"> 
    
    <!--======= PAGES INNER =========-->
    <section class="chart-page padding-top-100 padding-bottom-100">
      <div class="container"> 
        
        <!-- Payments Steps -->
        <div class="shopping-cart"> 
          
          <!-- SHOPPING INFORMATION -->
          <div class="cart-ship-info">
            <div class="row"> 
              
              <!-- ESTIMATE SHIPPING & TAX -->
              <div class="col-sm-7">
                <h6>BILLING DETAILS</h6>
                <form method="POST" action="{% url 'checkout' %}">
                  {% csrf_token %}
                  <ul class="row">
                    
                    <!-- Name -->
                    <li class="col-md-6">
                      <label> *FIRST NAME
                        {{form1.firstname}}
                        <!-- <input type="text" name="first-name" value="" placeholder=""> -->
                      </label>
                    </li>
                    <!-- LAST NAME -->
                    <li class="col-md-6">
                      <label> *LAST NAME
                        {{form1.lastname}}
                        <!-- <input type="text" name="last-name" value="" placeholder=""> -->
                      </label>
                    </li>
                    <li class="col-md-6"> 
                      <!-- COMPANY NAME -->
                      <label>COMPANY NAME
                        {{form1.company}}
                        <!-- <input type="text" name="company" value="" placeholder=""> -->
                      </label>
                    </li>
                    <li class="col-md-6"> 
                      <!-- ADDRESS -->
                      <label>*ADDRESS
                        {{form1.address}}
                        <!-- <input type="text" name="address" value="" placeholder=""> -->
                      </label>
                    </li>
                    <!-- TOWN/CITY -->
                    <li class="col-md-6">
                      <label>*TOWN/CITY
                        {{form1.city}}
                        <!-- <input type="text" name="town" value="" placeholder=""> -->
                      </label>
                    </li>
                    
                    <!-- COUNTRY -->
                    <li class="col-md-6">
                      <label> COUNTRY
                        {{form1.country}}
                        <!-- <input type="text" name="contry-state" value="" placeholder=""> -->
                      </label>
                    </li>
                    
                    <!-- EMAIL ADDRESS -->
                    <li class="col-md-6">
                      <label> *EMAIL ADDRESS
                        {{form1.email}}
                        <!-- <input type="text" name="contry-state" value="" placeholder=""> -->
                      </label>
                    </li>
                    <!-- PHONE -->
                    <li class="col-md-6">
                      <label> *PHONE
                        {{form1.phone}}
                        <!-- <input type="text" name="postal-code" value="" placeholder=""> -->
                      </label>
                    </li>
                    
                    <!-- PHONE -->
                    <li class="col-md-6">
                      <button type="submit" class="btn btn-danger">continue</button>
                    </li>
                    
                    <!-- CREATE AN ACCOUNT -->
                    <!-- <li class="col-md-6">
                      <div class="checkbox margin-0 margin-top-20">
                        <input id="checkbox1" class="styled" type="checkbox">
                        <label for="checkbox1"> Ship to a different address </label>
                      </div>
                    </li> -->
                  </ul>
                </form>
                
                <!-- SHIPPING info -->
                <h6 class="margin-top-50">SHIPPING info</h6>
                <form action="{% url 'checkout' %}" method="POST">
                  {% csrf_token %}
                  <ul class="row">
                    <!-- {% for field in form %}
                      {{field}}
                    {% endfor %} -->
                    <!-- Name -->
                    <li class="col-md-6">
                      <label> *FIRST NAME
                        {{form.first_name}}
                        <!-- <input type="text" name="first-name" value="" placeholder=""> -->
                      </label>
                    </li>
                    <!-- LAST NAME -->
                    <li class="col-md-6">
                      <label> *LAST NAME
                        {{form.last_name}}
                        <!-- <input type="text" name="last-name" value="" placeholder=""> -->
                      </label>
                    </li>
                    <li class="col-md-6"> 
                      <!-- COMPANY NAME -->
                      <label>COMPANY NAME
                        {{form.company}}
                        <!-- <input type="text" name="company" value="" placeholder=""> -->
                      </label>
                    </li>
                    <li class="col-md-6"> 
                      <!-- ADDRESS -->
                      <label>*ADDRESS
                        {{form.address}}
                        <!-- <input type="text" name="address" value="" placeholder=""> -->
                      </label>
                    </li>
                    <!-- TOWN/CITY -->
                    <li class="col-md-6">
                      <label>*TOWN/CITY
                        {{form.city}}
                        <!-- <input type="text" name="town" value="" placeholder=""> -->
                      </label>
                    </li>
                    
                    <!-- COUNTRY -->
                    <li class="col-md-6">
                      <label> COUNTRY
                        {{form.country}}
                        <!-- <input type="text" name="contry-state" value="" placeholder=""> -->
                      </label>
                    </li>
                    
                    <!-- EMAIL ADDRESS -->
                     <li class="col-md-6">
                      <label> *EMAIL ADDRESS
                        {{form.email}}

                        <!-- <input type="text" name="contry-state" value="" placeholder=""> -->
                      </label>
                    </li>
                    <!-- PHONE -->
                    <li class="col-md-6">
                      <label> *PHONE
                        {{form.phone}}
                        <!-- <input type="text" name="postal-code" value="" placeholder=""> -->
                      </label>
                    </li> -->
                    
                    <!-- PHONE -->
                    <li class="col-md-6">
                      <button type="submit" class="btn">SUBMIT</button>
                    </li>
                  </ul>
                </form>
                </div>
              
              <!-- SUB TOTAL -->
              <div class="col-sm-5">
                <h6>YOUR ORDER</h6>
                <div class="order-place">
                  <div class="order-detail">
                    <!-- <p>WOOD CHAIR <span>$598 </span></p> -->
                  
                    
                    <!-- SUB TOTAL -->
                    <p class="all-total">TOTAL COST 
                      <!-- <span> $998</span> -->
                    </p>
                  </div>
                  <div class="pay-meth">
                    <ul>

                      <li>
                        <div id="paypal-button-container"></div>   
                        {% for item in cartitem %}  
                       
                        <script src="https://www.paypal.com/sdk/js?client-id=Aco4fuQVmi5OhD0n0XRVcLRm_34meZK3sHXjfxfcKrfB6s2q_aKuJaZiBgYmf77niO6BZfBROiVaLGM3&currency=USD"></script>
                        <script>
                          function getCookie(name) {
                            let cookieValue = null;
                            if (document.cookie && document.cookie !== '') {
                                const cookies = document.cookie.split(';');
                                for (let i = 0; i < cookies.length; i++) {
                                    const cookie = cookies[i].trim();
                                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                        break;
                                    }
                                }
                            }
                            return cookieValue;
                        }
                        const token = getCookie('csrftoken');


                        var cartID={{item.cart}}
                        var data={
                            'status':true
                        }
                        function completeOrder(){
                            var url = `http://localhost:8000/api/order/${cartID}/`

                            fetch(url, {
                                method:'PATCH',
                                headers:{
                                    'Content-type':'application/json',
                                    'X-CSRFToken':token,
                                },
                                body:JSON.stringify(data),
                                success: window.location='/products/'
                            })

                        }
                          // Render the PayPal button into #paypal-button-container
                          paypal.Buttons({
                  
                              // Set up the transaction
                              createOrder: function(data, actions) {
                                  return actions.order.create({
                                      purchase_units: [{
                                          amount: {
                                              value: {{item.sub_total}}   
                                          }
                                      }]
                                  });
                              },
                  
                              // Finalize the transaction
                              onApprove: function(data, actions) {
                                  return actions.order.capture().then(function(orderData) {
                               
                                      // Successful capture! For demo purposes:
                                      completeOrder()
                                      console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                                      var transaction = orderData.purchase_units[0].payments.captures[0];
                                      alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');
                  
                                      // Replace the above to show a success message within this page, e.g.
                                      // const element = document.getElementById('paypal-button-container');
                                      // element.innerHTML = '';
                                      // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                                      // Or go to another URL:  actions.redirect('thank_you.html');
                                  });
                              }
                  
                  
                          }).render('#paypal-button-container');
                      </script>
                     {% endfor %} 
                      </li>
                      <li>
                        <div class="checkbox">
                          <input id="checkbox3-4" class="styled" type="checkbox">
                          <label for="checkbox3-4"> I’VE READ AND ACCEPT THE <span class="color"> TERMS & CONDITIONS </span> </label>
                        </div>
                      </li>
                    </ul>
                    <a href="#." class="btn  btn-dark pull-right margin-top-30">PLACE ORDER</a> </div>
                </div> 
               
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- About -->
    <section class="small-about padding-top-150 padding-bottom-150">
      <div class="container"> 
        
        <!-- Main Heading -->
        <div class="heading text-center">
          <h4>about PAVSHOP</h4>
          <p>Phasellus lacinia fermentum bibendum. Interdum et malesuada fames ac ante ipsumien lacus, eu posuere odio luctus non. Nulla lacinia,
            eros vel fermentum consectetur, risus purus tempc, et iaculis odio dolor in ex. </p>
        </div>
        
        <!-- Social Icons -->
        <ul class="social_icons">
          <li><a href="#."><i class="icon-social-facebook"></i></a></li>
          <li><a href="#."><i class="icon-social-twitter"></i></a></li>
          <li><a href="#."><i class="icon-social-tumblr"></i></a></li>
          <li><a href="#."><i class="icon-social-youtube"></i></a></li>
          <li><a href="#."><i class="icon-social-dribbble"></i></a></li>
        </ul>
      </div>
    </section>
    
  
  </div>
  <!-- <script src="{% static 'js/checkout.js' %}"></script> -->
  <!--======= FOOTER =========-->
  {% endblock %}